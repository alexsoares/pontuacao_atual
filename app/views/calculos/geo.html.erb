<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-us">
  <head>
    <title>GoogleMaps Geolocation with jQuery</title>
	  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
 	  <link rel="stylesheet" href="/stylesheets/style.css" type="text/css" media="screen" charset="utf-8" />
  </head>
  <body>
    <div id="container">
      <div id="mapCanvas">
        Loading Map
      </div>

      <div id="addressList">

         <table width="100%">
          <tr>
            <% form_tag geo_path, :method => 'get' do %>
              <tr>
                <td align="right"></td>
                <div id="unidade">
                  <%= label :id, "Unidade" %>
                  <%= collection_select :unit, :id, Unidade.all, :id, :nome, :include_blank => true%>
                </div>
                <td align="center" colspan="2">
                  <%= submit_tag "Buscar" %>
                </td>
              </tr>
             <%end%>
          </tr>
        </table>

        <ul>
          <li><a href="#">1 Infinite Loop, Cupertino, Santa Clara, California 95014</a></li>
          <li><a href="#"><div id="endereco"</a></li>
          <li><a href="#">Av. Infante Dom Henrique Aterro do Flamengo RJ, Rio de Janeiro</a></li>
          <li><a href="#">Pra√ßa do Papa, Belo Horizonte - Minas Gerais, Brasil</a></li>
          
        </ul>
      </div>
    </div>
        <%= observe_field 'unit_unidade_id',
           :url    => { :action => 'endereco' },
           :with   => 'unit_unidade_id',
           :update => "endereco"%>


    <script src="http://maps.google.com/maps/api/js?sensor=false" type="text/javascript"></script>
	  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.5.0/jquery.js" type="text/javascript"></script>
    <script src="/javascripts/jquery.geolocation.js" type="text/javascript"></script>

    <script type="text/javascript" charset="utf-8">

    $(document).ready(function() {
      var firstAddress = $("#addressList li:first a").html();
      $("#mapCanvas").geolocate(firstAddress);
      $("#addressList li a").click(geolocateAddress);
    });

    function geolocateAddress(event) {
      var address = $(this).html();
      $("#mapCanvas").geolocate(address);
    }
    </script>
  </body>
</html>